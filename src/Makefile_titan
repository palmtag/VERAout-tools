#
#  Makefile for Titan
#  2014/04/29
#
#  Must add the following modules:
#  > module add intel
#  > module add cray-hdf5
#
# CRAY_HDF5_DIR=/opt/cray/hdf5/1.8.11
#
HDF5=$(CRAY_HDF5_DIR)/intel/130

FC  = ifort
FFLAGS = -O0 -traceback -I$(HDF5)/include
HDFOPT=-L$(HDF5)/lib -lhdf5 -lhdf5_fortran -ldl -lm

.SUFFIXES:
.SUFFIXES: .o .f90 .exe

all:    hunittest.exe makehdf.exe mpactread.exe mpactxmf.exe ctfread.exe veradiff.exe

mpactread.exe: Mod_hdftools.o mpactread.o output_utils.o
	$(FC) $(FFLAGS) Mod_hdftools.o mpactread.o output_utils.o $(HDFOPT) -o $@

mpactxmf.exe: Mod_hdftools.o mpactxmf.o
	$(FC) $(FFLAGS) Mod_hdftools.o mpactxmf.o $(HDFOPT) -o $@

ctfread.exe: Mod_hdftools.o ctfread.o output_utils.o
	$(FC) $(FFLAGS) Mod_hdftools.o ctfread.o output_utils.o $(HDFOPT) -o $@

hunittest.exe: Mod_hdftools.o hunittest.o
	$(FC) $(FFLAGS) Mod_hdftools.o hunittest.o $(HDFOPT) -o $@

makehdf.exe: Mod_hdftools.o makehdf.o
	$(FC) $(FFLAGS) Mod_hdftools.o makehdf.o $(HDFOPT) -o $@

veradiff.exe: Mod_hdftools.o veradiff.o
	$(FC) $(FFLAGS) Mod_hdftools.o veradiff.o $(HDFOPT) -o $@

.f90.o:
	$(FC) $(FFLAGS) -c $*.f90

clean:
	rm -f *.o *.exe *.mod dsetunit.h5

mpactread.o : Mod_hdftools.o
mpactxmf.o : Mod_hdftools.o
ctfread.o : Mod_hdftools.o
hunittest.o : Mod_hdftools.o
makehdf.o : Mod_hdftools.o
veradiff.o : Mod_hdftools.o

